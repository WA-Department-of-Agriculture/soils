% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/texture.R
\name{classify_texture}
\alias{classify_texture}
\title{Classify USDA soil texture from particle-size fractions}
\source{
Thresholds for texture classification are based on the \href{https://www.nrcs.usda.gov/resources/education-and-teaching-materials/soil-texture-calculator}{USDA NRCS Soil Texture Calculator}.
}
\usage{
classify_texture(df)
}
\arguments{
\item{df}{A data frame containing the columns \code{sample_id},
\code{sand_percent}, \code{silt_percent}, and \code{clay_percent}. An
optional \code{texture} column can also be provided: if the sand/silt/clay
fractions are present, \code{texture} will be overwritten by the classified
value; if the fractions are missing, existing \code{texture} values are
preserved.}
}
\value{
A data frame with a \code{texture} column containing USDA soil
texture classes. Soil fractions are rounded to whole numbers.
}
\description{
Validates soil particle-size fractions (sand, silt, and clay), completes
missing values when possible, and assigns a USDA soil texture class.
}
\details{
\code{classify_texture()} applies the following validation rules and
assumptions:

\itemize{
\item Each sample must contain values for at least two of
\code{sand_percent}, \code{silt_percent}, and \code{clay_percent}.
Samples with fewer than two provided fractions must be corrected before
texture classification can proceed.

\item When exactly one fraction is missing, it is calculated as
\code{100 - (sum of the other two)}.

\item All fraction values must fall within the range 0–100. Samples with all
three fractions must sum to 100 with a ±1 tolerance (allowable range
99-101).

\item Samples with all three fractions missing are assumed to not have
texture measured. These samples are retained and returned without
fraction-based classification.

\item If a \code{texture} column is provided, non-missing texture values
are preserved and are not overwritten by fraction-based classification.
This allows users to supply texture classes from external sources (e.g.,
NRCS gSSURGO) when particle-size fractions are unavailable.
}
}
\examples{

# Three samples classified without error

df <- data.frame(
  sample_id = c(1, 2, 3),
  sand_percent = c(20, 45, 75),
  silt_percent = c(65, 35, 15),
  clay_percent = c(15, 20, 10)
)

classify_texture(df)

# Error when a sample has insufficient data
# One sample is missing two soil fractions

df <- data.frame(
  sample_id = c(1, 2, 3),
  sand_percent = c(40, NA, 65),
  silt_percent = c(40, 55, 5),
  clay_percent = c(20, NA, 30)
)

try(classify_texture(df))

# Error when any fraction is outside the allowable range (0-100)

df <- data.frame(
  sample_id = c(1, 2, 3),
  sand_percent = c(40, 0, 65),
  silt_percent = c(40, 55, 5),
  clay_percent = c(20, 110, 30)
)

try(classify_texture(df))

# Error when fractions do not sum to 100 +/- 1 (allowable range: 99-101)

df <- data.frame(
  sample_id = c(1, 2, 3),
  sand_percent = c(40, 0, 90),
  silt_percent = c(40, 55, 5),
  clay_percent = c(20, 45, 30)
)

try(classify_texture(df))

# Warn when one fraction is missing
# The missing fraction is calculated as 100 minus the other two

df <- data.frame(
  sample_id = c(1, 2, 3),
  sand_percent = c(NA, 60, 25),
  silt_percent = c(45, 10, 40),
  clay_percent = c(50, 30, 35)
)

classify_texture(df)

# Warn when soil texture was not measured
# Samples with all fractions missing return a blank texture class

  df <- data.frame(
   sample_id = c(1, 2, 3),
   sand_percent = c(NA, NA, 30),
   silt_percent = c(NA, NA, 30),
   clay_percent = c(NA, NA, 40)
 )

 classify_texture(df)

}
