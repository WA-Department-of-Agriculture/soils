% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/texture.R
\name{classify_texture}
\alias{classify_texture}
\title{Classify USDA soil texture from particle-size fractions}
\source{
Thresholds for texture classification are based on the \href{https://www.nrcs.usda.gov/resources/education-and-teaching-materials/soil-texture-calculator}{USDA NRCS Soil Texture Calculator}.
}
\usage{
classify_texture(df)
}
\arguments{
\item{df}{A data frame containing the columns \code{sample_id}, \code{sand_percent},
\code{silt_percent}, and \code{clay_percent}. An optional \code{texture} column can also
be provided.}
}
\value{
A data frame with a \code{texture} column containing USDA soil texture
classes (if enough soil fraction data are provided). Soil fractions are
rounded to whole numbers.
}
\description{
Validates soil particle-size fractions (sand, silt, and clay), completes
missing values when possible, and assigns a USDA soil texture class.
}
\details{
\code{classify_texture()} applies the following validation rules and
assumptions:

\itemize{
\item \strong{Eligibility}
\itemize{
\item Each sample must contain values for at least two of
\code{sand_percent}, \code{silt_percent}, and \code{clay_percent} to be eligible for
fraction-based texture classification.
}

\item \strong{Errors} (cause validation to fail)
\itemize{
\item All fraction values must fall within the range 0–100.
\item Samples with all three fractions must sum to 100 with a
±1 tolerance (allowable range 99–101).
}

\item \strong{Warnings} (validation continues)
\itemize{
\item When exactly one fraction is missing, it is calculated as
\verb{100 - (sum of the other two)}.
\item Samples with fewer than two provided fractions \strong{and no} provided
texture do not have sufficient data for texture classification.
These samples are retained and returned with an \code{NA} texture value.
}

\item \strong{Special cases} (no warning or error)
\itemize{
\item Samples with fewer than two provided fractions \strong{and} a provided
texture will preserve the texture without modification.
}
}
}
\examples{

# Three samples classified without error

df <- data.frame(
  sample_id = c(1, 2, 3),
  sand_percent = c(20, 45, 75),
  silt_percent = c(65, 35, 15),
  clay_percent = c(15, 20, 10)
)

classify_texture(df)

# Error when any fraction is outside the allowable range (0-100)

df <- data.frame(
  sample_id = c(1, 2, 3),
  sand_percent = c(40, 0, 65),
  silt_percent = c(40, 55, 5),
  clay_percent = c(20, 110, 30)
)

try(classify_texture(df))

# Error when fractions do not sum to 100 +/- 1 (allowable range: 99-101)

df <- data.frame(
  sample_id = c(1, 2, 3),
  sand_percent = c(40, 0, 90),
  silt_percent = c(40, 55, 5),
  clay_percent = c(20, 45, 30)
)

try(classify_texture(df))

# Warn when one fraction is missing
# The missing fraction is calculated as 100 minus the other two

df <- data.frame(
  sample_id = c(1, 2, 3),
  sand_percent = c(NA, 60, 25),
  silt_percent = c(45, 10, 40),
  clay_percent = c(50, 30, 35)
)

classify_texture(df)

# Warn when a sample has insufficient data and classification is skipped
# One sample is missing two soil fractions

df <- data.frame(
  sample_id = c(1, 2, 3),
  sand_percent = c(40, NA, 65),
  silt_percent = c(40, 55, 5),
  clay_percent = c(20, NA, 30)
)

classify_texture(df)

# No fractions provided, but texture is supplied
# No warning; existing texture is preserved

df <- data.frame(
  sample_id = c(1, 2),
  sand_percent = c(NA, NA),
  silt_percent = c(NA, NA),
  clay_percent = c(NA, NA),
  texture = c("Loam", "Sandy loam")
)

classify_texture(df)
}
